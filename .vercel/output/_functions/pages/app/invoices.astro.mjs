import { c as createComponent, a as renderTemplate, r as renderComponent, m as maybeRenderHead } from '../../chunks/astro/server_C7RkpNfc.mjs';
import { $ as $$BackendLayout } from '../../chunks/BackendLayout_y7hU8ANi.mjs';
export { renderers } from '../../renderers.mjs';

var __freeze = Object.freeze;
var __defProp = Object.defineProperty;
var __template = (cooked, raw) => __freeze(__defProp(cooked, "raw", { value: __freeze(raw || cooked.slice()) }));
var _a;
const $$Invoices = createComponent(async ($$result, $$props, $$slots) => {
  return renderTemplate(_a || (_a = __template(["", ` <script type="module">
  import { authFetch } from '~/utils/backend/api';

  const form = document.getElementById('invoice-form');
  const message = document.getElementById('invoice-message');
  const submitButton = document.getElementById('invoice-submit');
  const tableBody = document.getElementById('invoice-table');
  const clientSelect = document.getElementById('client_id');
  const projectSelect = document.getElementById('project_id');

  const clientLookup = {};

  const loadClients = async () => {
    if (!clientSelect) return;
    clientSelect.innerHTML = '<option value="">Loading clients\u2026</option>';
    Object.keys(clientLookup).forEach((key) => delete clientLookup[key]);
    try {
      const response = await authFetch('/clients');
      const clients = response.clients ?? [];
      if (!clients.length) {
        clientSelect.innerHTML = '<option value="">Add a client first</option>';
        return;
      }
      clientSelect.innerHTML = clients
        .map((client) => {
          clientLookup[client.id] = client.company_name;
          return \`<option value="\${client.id}">\${client.company_name}</option>\`;
        })
        .join('');
    } catch (error) {
      console.error(error);
      clientSelect.innerHTML = '<option value="">Unable to load clients</option>';
    }
  };

  const loadProjects = async () => {
    if (!projectSelect) return;
    projectSelect.innerHTML = '<option value="">Optional</option>';
    try {
      const response = await authFetch('/projects');
      const projects = response.projects ?? [];
      if (!projects.length) return;
      projectSelect.innerHTML = '<option value="">Optional</option>' +
        projects.map((project) => \`<option value="\${project.id}">\${project.name}</option>\`).join('');
    } catch (error) {
      console.error(error);
    }
  };

  const renderInvoices = (invoices) => {
    if (!tableBody) return;
    tableBody.innerHTML = '';

    if (!invoices.length) {
      tableBody.innerHTML = '<tr><td colspan="6" class="px-4 py-6 text-center text-sm text-slate-600 dark:text-slate-400">No invoices yet. Create one above.</td></tr>';
      return;
    }

    invoices.forEach((invoice) => {
      const row = document.createElement('tr');
      const formatter = new Intl.NumberFormat(undefined, {
        style: 'currency',
        currency: invoice.currency ?? 'USD',
      });
      row.innerHTML = \`
        <td class="px-4 py-3">
          <div class="font-medium text-slate-900 dark:text-white">\${invoice.invoice_number}</div>
          <div class="text-xs text-slate-500 dark:text-slate-400">\${invoice.issue_date ? new Date(invoice.issue_date).toLocaleDateString() : ''}</div>
        </td>
        <td class="px-4 py-3 text-sm">\${clientLookup[invoice.client_id] ?? invoice.client_id ?? ''}</td>
        <td class="px-4 py-3"><span class="inline-flex rounded-full bg-slate-100 dark:bg-slate-800 px-2.5 py-1 text-xs capitalize text-slate-700 dark:text-slate-200">\${invoice.status}</span></td>
        <td class="px-4 py-3 text-sm text-slate-700 dark:text-slate-200">\${formatter.format(invoice.amount ?? 0)}</td>
        <td class="px-4 py-3 text-xs text-slate-500 dark:text-slate-300">\${invoice.due_date ? new Date(invoice.due_date).toLocaleDateString() : '\u2014'}</td>
        <td class="px-4 py-3 text-right">
          <button data-delete="\${invoice.id}" class="rounded-lg border border-red-200 px-3 py-1 text-xs text-red-600 transition hover:bg-red-50 dark:border-red-500/40 dark:text-red-300 dark:hover:bg-red-500/10">Delete</button>
        </td>\`;
      tableBody.appendChild(row);
    });
  };

  const loadInvoices = async () => {
    try {
      const response = await authFetch('/invoices');
      renderInvoices(response.invoices ?? []);
    } catch (error) {
      console.error(error);
      if (tableBody) {
        tableBody.innerHTML = '<tr><td colspan="6" class="px-4 py-6 text-center text-sm text-red-400">Unable to load invoices.</td></tr>';
      }
    }
  };

  if (form) {
    form.addEventListener('submit', async (event) => {
      event.preventDefault();
      if (message) {
        message.classList.remove('text-red-400', 'text-blue-600', 'dark:text-blue-400');
        message.textContent = '';
      }
      if (submitButton) {
        submitButton.classList.add('animate-pulse');
        submitButton.disabled = true;
      }

      const formData = new FormData(form);
      const quantity = Number(formData.get('line_quantity') ?? 1) || 1;
      const unitAmount = Number(formData.get('line_unit_amount') ?? 0) || 0;
      const amount = quantity * unitAmount;

      const payload = {
        invoice_number: String(formData.get('invoice_number') ?? '').trim(),
        client_id: String(formData.get('client_id') ?? ''),
        project_id: String(formData.get('project_id') ?? '') || null,
        status: String(formData.get('status') ?? 'draft'),
        issue_date: String(formData.get('issue_date') ?? ''),
        due_date: String(formData.get('due_date') ?? ''),
        currency: String(formData.get('currency') ?? 'USD').trim(),
        amount,
        line_items: [
          {
            description: String(formData.get('line_description') ?? '').trim(),
            quantity,
            unit_amount: unitAmount,
          },
        ],
        notes: String(formData.get('notes') ?? '').trim() || null,
      };

      try {
        await authFetch('/invoices', {
          method: 'POST',
          body: JSON.stringify(payload),
        });
        if (message) {
          message.classList.add('text-blue-600', 'dark:text-blue-400');
          message.textContent = 'Invoice saved.';
        }
        form.reset();
        await loadInvoices();
      } catch (error) {
        console.error(error);
        if (message) {
          message.classList.add('text-red-400');
          message.textContent = error instanceof Error ? error.message : 'Failed to save invoice.';
        }
      } finally {
        if (submitButton) {
          submitButton.classList.remove('animate-pulse');
          submitButton.disabled = false;
        }
      }
    });
  }

  if (tableBody) {
    tableBody.addEventListener('click', async (event) => {
      const target = event.target;
      if (!(target instanceof HTMLElement)) return;
      const deleteId = target.getAttribute('data-delete');
      if (!deleteId) return;

      target.classList.add('animate-pulse');
      try {
        await authFetch(\`/invoices/\${deleteId}\`, {
          method: 'DELETE',
          parseJson: false,
        });
        await loadInvoices();
      } catch (error) {
        console.error(error);
      }
    });
  }

  await loadClients();
  await loadProjects();
  await loadInvoices();
<\/script>`], ["", ` <script type="module">
  import { authFetch } from '~/utils/backend/api';

  const form = document.getElementById('invoice-form');
  const message = document.getElementById('invoice-message');
  const submitButton = document.getElementById('invoice-submit');
  const tableBody = document.getElementById('invoice-table');
  const clientSelect = document.getElementById('client_id');
  const projectSelect = document.getElementById('project_id');

  const clientLookup = {};

  const loadClients = async () => {
    if (!clientSelect) return;
    clientSelect.innerHTML = '<option value="">Loading clients\u2026</option>';
    Object.keys(clientLookup).forEach((key) => delete clientLookup[key]);
    try {
      const response = await authFetch('/clients');
      const clients = response.clients ?? [];
      if (!clients.length) {
        clientSelect.innerHTML = '<option value="">Add a client first</option>';
        return;
      }
      clientSelect.innerHTML = clients
        .map((client) => {
          clientLookup[client.id] = client.company_name;
          return \\\`<option value="\\\${client.id}">\\\${client.company_name}</option>\\\`;
        })
        .join('');
    } catch (error) {
      console.error(error);
      clientSelect.innerHTML = '<option value="">Unable to load clients</option>';
    }
  };

  const loadProjects = async () => {
    if (!projectSelect) return;
    projectSelect.innerHTML = '<option value="">Optional</option>';
    try {
      const response = await authFetch('/projects');
      const projects = response.projects ?? [];
      if (!projects.length) return;
      projectSelect.innerHTML = '<option value="">Optional</option>' +
        projects.map((project) => \\\`<option value="\\\${project.id}">\\\${project.name}</option>\\\`).join('');
    } catch (error) {
      console.error(error);
    }
  };

  const renderInvoices = (invoices) => {
    if (!tableBody) return;
    tableBody.innerHTML = '';

    if (!invoices.length) {
      tableBody.innerHTML = '<tr><td colspan="6" class="px-4 py-6 text-center text-sm text-slate-600 dark:text-slate-400">No invoices yet. Create one above.</td></tr>';
      return;
    }

    invoices.forEach((invoice) => {
      const row = document.createElement('tr');
      const formatter = new Intl.NumberFormat(undefined, {
        style: 'currency',
        currency: invoice.currency ?? 'USD',
      });
      row.innerHTML = \\\`
        <td class="px-4 py-3">
          <div class="font-medium text-slate-900 dark:text-white">\\\${invoice.invoice_number}</div>
          <div class="text-xs text-slate-500 dark:text-slate-400">\\\${invoice.issue_date ? new Date(invoice.issue_date).toLocaleDateString() : ''}</div>
        </td>
        <td class="px-4 py-3 text-sm">\\\${clientLookup[invoice.client_id] ?? invoice.client_id ?? ''}</td>
        <td class="px-4 py-3"><span class="inline-flex rounded-full bg-slate-100 dark:bg-slate-800 px-2.5 py-1 text-xs capitalize text-slate-700 dark:text-slate-200">\\\${invoice.status}</span></td>
        <td class="px-4 py-3 text-sm text-slate-700 dark:text-slate-200">\\\${formatter.format(invoice.amount ?? 0)}</td>
        <td class="px-4 py-3 text-xs text-slate-500 dark:text-slate-300">\\\${invoice.due_date ? new Date(invoice.due_date).toLocaleDateString() : '\u2014'}</td>
        <td class="px-4 py-3 text-right">
          <button data-delete="\\\${invoice.id}" class="rounded-lg border border-red-200 px-3 py-1 text-xs text-red-600 transition hover:bg-red-50 dark:border-red-500/40 dark:text-red-300 dark:hover:bg-red-500/10">Delete</button>
        </td>\\\`;
      tableBody.appendChild(row);
    });
  };

  const loadInvoices = async () => {
    try {
      const response = await authFetch('/invoices');
      renderInvoices(response.invoices ?? []);
    } catch (error) {
      console.error(error);
      if (tableBody) {
        tableBody.innerHTML = '<tr><td colspan="6" class="px-4 py-6 text-center text-sm text-red-400">Unable to load invoices.</td></tr>';
      }
    }
  };

  if (form) {
    form.addEventListener('submit', async (event) => {
      event.preventDefault();
      if (message) {
        message.classList.remove('text-red-400', 'text-blue-600', 'dark:text-blue-400');
        message.textContent = '';
      }
      if (submitButton) {
        submitButton.classList.add('animate-pulse');
        submitButton.disabled = true;
      }

      const formData = new FormData(form);
      const quantity = Number(formData.get('line_quantity') ?? 1) || 1;
      const unitAmount = Number(formData.get('line_unit_amount') ?? 0) || 0;
      const amount = quantity * unitAmount;

      const payload = {
        invoice_number: String(formData.get('invoice_number') ?? '').trim(),
        client_id: String(formData.get('client_id') ?? ''),
        project_id: String(formData.get('project_id') ?? '') || null,
        status: String(formData.get('status') ?? 'draft'),
        issue_date: String(formData.get('issue_date') ?? ''),
        due_date: String(formData.get('due_date') ?? ''),
        currency: String(formData.get('currency') ?? 'USD').trim(),
        amount,
        line_items: [
          {
            description: String(formData.get('line_description') ?? '').trim(),
            quantity,
            unit_amount: unitAmount,
          },
        ],
        notes: String(formData.get('notes') ?? '').trim() || null,
      };

      try {
        await authFetch('/invoices', {
          method: 'POST',
          body: JSON.stringify(payload),
        });
        if (message) {
          message.classList.add('text-blue-600', 'dark:text-blue-400');
          message.textContent = 'Invoice saved.';
        }
        form.reset();
        await loadInvoices();
      } catch (error) {
        console.error(error);
        if (message) {
          message.classList.add('text-red-400');
          message.textContent = error instanceof Error ? error.message : 'Failed to save invoice.';
        }
      } finally {
        if (submitButton) {
          submitButton.classList.remove('animate-pulse');
          submitButton.disabled = false;
        }
      }
    });
  }

  if (tableBody) {
    tableBody.addEventListener('click', async (event) => {
      const target = event.target;
      if (!(target instanceof HTMLElement)) return;
      const deleteId = target.getAttribute('data-delete');
      if (!deleteId) return;

      target.classList.add('animate-pulse');
      try {
        await authFetch(\\\`/invoices/\\\${deleteId}\\\`, {
          method: 'DELETE',
          parseJson: false,
        });
        await loadInvoices();
      } catch (error) {
        console.error(error);
      }
    });
  }

  await loadClients();
  await loadProjects();
  await loadInvoices();
<\/script>`])), renderComponent($$result, "BackendLayout", $$BackendLayout, { "pageTitle": "Invoices" }, { "default": async ($$result2) => renderTemplate` ${maybeRenderHead()}<section class="space-y-8"> <div class="rounded-2xl border border-slate-200 bg-white px-6 py-6 shadow-md shadow-slate-200/60 dark:border-slate-800 dark:bg-slate-900/40 dark:shadow-lg dark:shadow-slate-950/40"> <h2 class="text-lg font-semibold text-slate-900 dark:text-white">Generate an invoice</h2> <p class="mt-2 text-sm text-slate-600 dark:text-slate-400">Send polished billing straight from your operations backend.</p> <form id="invoice-form" class="mt-6 grid gap-4 lg:grid-cols-3"> <div class="lg:col-span-1"> <label class="block text-sm text-slate-600 dark:text-slate-300" for="invoice_number">Invoice number</label> <input id="invoice_number" name="invoice_number" required class="mt-2 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/40 dark:border-slate-800 dark:bg-slate-950 dark:text-white"> </div> <div class="lg:col-span-1"> <label class="block text-sm text-slate-600 dark:text-slate-300" for="client_id">Client</label> <select id="client_id" name="client_id" required class="mt-2 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/40 dark:border-slate-800 dark:bg-slate-950 dark:text-white"> <option value="">Loading clients…</option> </select> </div> <div class="lg:col-span-1"> <label class="block text-sm text-slate-600 dark:text-slate-300" for="project_id">Project</label> <select id="project_id" name="project_id" class="mt-2 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/40 dark:border-slate-800 dark:bg-slate-950 dark:text-white"> <option value="">Optional</option> </select> </div> <div class="lg:col-span-1"> <label class="block text-sm text-slate-600 dark:text-slate-300" for="status">Status</label> <select id="status" name="status" class="mt-2 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/40 dark:border-slate-800 dark:bg-slate-950 dark:text-white"> <option value="draft">Draft</option> <option value="sent">Sent</option> <option value="paid">Paid</option> <option value="overdue">Overdue</option> </select> </div> <div class="lg:col-span-1"> <label class="block text-sm text-slate-600 dark:text-slate-300" for="issue_date">Issue date</label> <input id="issue_date" name="issue_date" type="date" required class="mt-2 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/40 dark:border-slate-800 dark:bg-slate-950 dark:text-white"> </div> <div class="lg:col-span-1"> <label class="block text-sm text-slate-600 dark:text-slate-300" for="due_date">Due date</label> <input id="due_date" name="due_date" type="date" required class="mt-2 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/40 dark:border-slate-800 dark:bg-slate-950 dark:text-white"> </div> <div> <label class="block text-sm text-slate-600 dark:text-slate-300" for="currency">Currency</label> <input id="currency" name="currency" required placeholder="USD" class="mt-2 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/40 dark:border-slate-800 dark:bg-slate-950 dark:text-white"> </div> <div> <label class="block text-sm text-slate-600 dark:text-slate-300" for="line_description">Line item description</label> <input id="line_description" name="line_description" required class="mt-2 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/40 dark:border-slate-800 dark:bg-slate-950 dark:text-white"> </div> <div> <label class="block text-sm text-slate-600 dark:text-slate-300" for="line_quantity">Qty</label> <input id="line_quantity" name="line_quantity" type="number" min="1" value="1" class="mt-2 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/40 dark:border-slate-800 dark:bg-slate-950 dark:text-white"> </div> <div> <label class="block text-sm text-slate-600 dark:text-slate-300" for="line_unit_amount">Unit amount</label> <input id="line_unit_amount" name="line_unit_amount" type="number" min="0" step="0.01" required class="mt-2 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/40 dark:border-slate-800 dark:bg-slate-950 dark:text-white"> </div> <div class="lg:col-span-3"> <label class="block text-sm text-slate-600 dark:text-slate-300" for="notes">Notes</label> <textarea id="notes" name="notes" rows="3" class="mt-2 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/40 dark:border-slate-800 dark:bg-slate-950 dark:text-white"></textarea> </div> <div class="lg:col-span-3 flex items-center gap-3"> <button id="invoice-submit" type="submit" class="rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-md shadow-blue-500/30 transition hover:bg-blue-500 disabled:cursor-not-allowed disabled:opacity-70">Save invoice</button> <p id="invoice-message" class="text-sm text-slate-600 dark:text-slate-400"></p> </div> </form> </div> <div class="rounded-2xl border border-slate-200 bg-white px-6 py-6 shadow-md shadow-slate-200/60 dark:border-slate-800 dark:bg-slate-900/40 dark:shadow-lg dark:shadow-slate-950/40"> <div class="flex items-center justify-between"> <h2 class="text-lg font-semibold text-slate-900 dark:text-white">Billing queue</h2> <span class="text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400">Finance view</span> </div> <div class="mt-6 overflow-x-auto"> <table class="min-w-full text-left text-sm"> <thead class="text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400"> <tr> <th class="px-4 py-3">Invoice</th> <th class="px-4 py-3">Client</th> <th class="px-4 py-3">Status</th> <th class="px-4 py-3">Amount</th> <th class="px-4 py-3">Due</th> <th class="px-4 py-3 text-right">Actions</th> </tr> </thead> <tbody id="invoice-table" class="divide-y divide-slate-200 dark:divide-slate-800 text-slate-700 dark:text-slate-200"> <tr> <td colspan="6" class="px-4 py-6 text-center text-sm text-slate-600 dark:text-slate-400">Fetching invoices…</td> </tr> </tbody> </table> </div> </div> </section> ` }));
}, "/Users/pedroribeiro/iCloud Drive (Archive)/Documents/Coding/JS/monwebsite_factory/tonwebsite_ch/tonwebsite/src/pages/app/invoices.astro", void 0);

const $$file = "/Users/pedroribeiro/iCloud Drive (Archive)/Documents/Coding/JS/monwebsite_factory/tonwebsite_ch/tonwebsite/src/pages/app/invoices.astro";
const $$url = "/app/invoices";

const _page = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  default: $$Invoices,
  file: $$file,
  url: $$url
}, Symbol.toStringTag, { value: 'Module' }));

const page = () => _page;

export { page };
